# Redirect ALL HTTP to HTTPS
server {
    listen 80;
    server_name wam.mrbeas.net dashboard-backend.mrbeas.net mrbeas.net;
    return 301 https://$host$request_uri;
}

# Dashboard Service (wam.mrbeas.net)
server {
    listen 443 ssl;
    server_name wam.mrbeas.net;

    ssl_certificate /etc/ssl/certs/wam.mrbeas.net.crt;
    ssl_certificate_key /etc/ssl/private/wam.mrbeas.net.key;

    location / {
        proxy_pass http://dashboard:8080;  # Points to dashboard service
        proxy_set_header Host $host;
    }
}

# Backend Service (dashboard-backend.mrbeas.net) 
server {
    listen 443 ssl;
    server_name dashboard-backend.mrbeas.net;

    ssl_certificate /etc/ssl/certs/dashboard-backend.mrbeas.net.crt;
    ssl_certificate_key /etc/ssl/private/dashboard-backend.mrbeas.net.key;

    location / {
        proxy_pass http://backend:3000;  # Points to backend service
        proxy_set_header Host $host;
    }
}

# Website Service (mrbeas.net)
server {
    listen 443 ssl;
    server_name mrbeas.net;

    ssl_certificate /etc/ssl/certs/mrbeas.net.crt;
    ssl_certificate_key /etc/ssl/private/mrbeas.net.key;

    location / {
        proxy_pass http://website:8080;  # Points to website service
        proxy_set_header Host $host;
    }
}